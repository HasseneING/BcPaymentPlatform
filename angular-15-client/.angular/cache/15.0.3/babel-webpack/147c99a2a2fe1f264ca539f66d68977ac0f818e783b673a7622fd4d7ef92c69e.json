{"ast":null,"code":"import _asyncToGenerator from \"F:/DDesktop/MEAN_BC/mean-stack-authentication-authorization-master/angular-15-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Web3 from 'web3';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_services/user.service\";\nimport * as i2 from \"@angular/forms\";\nconst alchemy = require(\"alchemy-sdk\");\n// deteethproviderfix dont care how do it  \nexport class BoardUserComponent {\n  constructor(userService) {\n    var _this = this;\n    this.userService = userService;\n    this.depositForm = {\n      ethValue: null\n    };\n    this.walletConnected = false;\n    this.walletId = '';\n    this.walletBalance = '';\n    this.connectToWallet = () => {\n      this.userService.connectWallet();\n    };\n    this.checkWalletConnected = /*#__PURE__*/_asyncToGenerator(function* () {\n      const accounts = yield _this.userService.checkWalletConnected();\n      if (accounts.length > 0) {\n        _this.walletConnected = true;\n        _this.walletId = accounts[0];\n        console.log(_this.walletId);\n      }\n    });\n    const provider = \"https://sepolia.infura.io/v3/acaa2699bfc84be092239f5676e3192a\";\n    this.web3 = new Web3(provider);\n    var web3Provider = new Web3.providers.HttpProvider(provider);\n    var web3 = new Web3(web3Provider);\n    this.contractInst = new this.web3.eth.Contract(this.userService.abiContract, this.userService.contractAddress);\n  }\n  ngOnInit() {\n    this.connectToWallet();\n    this.userService.getUserBoard().subscribe({\n      next: data => {\n        this.content = data;\n      },\n      error: err => {\n        if (err.error) {\n          try {\n            const res = JSON.parse(err.error);\n            this.content = res.message;\n          } catch {\n            this.content = `Error with status: ${err.status} - ${err.statusText}`;\n          }\n        } else {\n          this.content = `Error with status: ${err.status}`;\n        }\n      }\n    });\n  }\n  getContractBalance() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      let contractBalance = _this2.contractInst.methods.getContractBalance().call();\n      return contractBalance;\n    })();\n  }\n  getWalletId() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      let balance2 = yield _this3.web3.eth.getBalance(_this3.walletId).then(res => {\n        _this3.walletBalance = res;\n      });\n    })();\n  }\n  onSubmit() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      _this4.checkWalletConnected();\n      let balance;\n      balance = _this4.getContractBalance().then(res => {\n        console.log(_this4.web3.utils.fromWei(res, \"ether\"), \"eth\");\n      });\n      console.log(_this4.depositForm);\n      console.log(_this4.walletId);\n      var accounts = yield _this4.web3.eth.getAccounts().then(console.log);\n      let balance2 = yield _this4.web3.eth.getBalance(_this4.walletId).then(res => {\n        _this4.walletBalance = res;\n      });\n      const transaction = _this4.web3.utils.toWei(String(_this4.depositForm.ethValue));\n      console.log(transaction, \"wei\");\n      //let txResult=await this.contractInst.methods.deposit().send({from: this.walletId,value:transaction});\n      var receiver = _this4.userService.contractAddress;\n      var sender = _this4.walletId;\n      let rawTransaction = yield _this4.web3.eth.signTransaction({\n        to: _this4.userService.contractAddress,\n        from: _this4.walletId,\n        value: transaction\n      });\n      //let tx = await alchemy.core.sendTransaction(rawTransaction);\n      /* this.web3.eth.sendTransaction({to:receiver,\r\n                               from:sender,\r\n                              value:this.web3.utils.toWei(String(this.depositForm.ethValue), \"ether\")}\r\n                               ,function (err, res){});*/\n      /*let txResult2=await contractInst.methods.\r\n      withdrawToOther(transaction006, \"0xe1e481Ba1AD79E5d644440847eeabb139eA3Bf06\").\r\n      send({from: accounts[0]});\r\n      */\n      //console.log(txResult2);\n      const exampleMessage = \"Hello testing Sign\";\n      const msg = `0x${Buffer.from(exampleMessage, 'utf8').toString('hex')}`;\n      /*  const sign = await this.web3.eth.signTransaction({\r\n          from:this.walletId,\r\n        });*/\n    })();\n  }\n}\n\nBoardUserComponent.ɵfac = function BoardUserComponent_Factory(t) {\n  return new (t || BoardUserComponent)(i0.ɵɵdirectiveInject(i1.UserService));\n};\nBoardUserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: BoardUserComponent,\n  selectors: [[\"app-board-user\"]],\n  decls: 10,\n  vars: 3,\n  consts: [[1, \"container\"], [1, \"jumbotron\"], [\"name\", \"depositForm\", 1, \"form-group\", 3, \"ngSubmit\"], [\"f\", \"ngForm\"], [\"for\", \"ethValue\"], [\"type\", \"number\", \"name\", \"ethValue\", 1, \"ethValue\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn\", \"btn-primary\", \"btn-block\"]],\n  template: function BoardUserComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"form\", 2, 3);\n      i0.ɵɵlistener(\"ngSubmit\", function BoardUserComponent_Template_form_ngSubmit_2_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(4, \"label\", 4);\n      i0.ɵɵtext(5, \"Value:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"input\", 5);\n      i0.ɵɵlistener(\"ngModelChange\", function BoardUserComponent_Template_input_ngModelChange_6_listener($event) {\n        return ctx.depositForm.ethValue = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"button\", 6);\n      i0.ɵɵtext(8, \"Deposit here\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtext(9);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngModel\", ctx.depositForm.ethValue);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate2(\" \", ctx.walletId, \" \", ctx.walletBalance + \" eth\", \" \");\n    }\n  },\n  dependencies: [i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.NgModel, i2.NgForm],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Web3","alchemy","require","BoardUserComponent","constructor","userService","ethValue","connectWallet","accounts","checkWalletConnected","length","walletConnected","walletId","console","log","provider","web3","web3Provider","providers","HttpProvider","contractInst","eth","Contract","abiContract","contractAddress","ngOnInit","connectToWallet","getUserBoard","subscribe","next","data","content","error","err","res","JSON","parse","message","status","statusText","getContractBalance","contractBalance","methods","call","getWalletId","balance2","getBalance","then","walletBalance","onSubmit","balance","utils","fromWei","depositForm","getAccounts","transaction","toWei","String","receiver","sender","rawTransaction","signTransaction","to","from","value","exampleMessage","msg","Buffer","toString","selectors","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["F:\\DDesktop\\MEAN_BC\\mean-stack-authentication-authorization-master\\angular-15-client\\src\\app\\board-user\\board-user.component.ts","F:\\DDesktop\\MEAN_BC\\mean-stack-authentication-authorization-master\\angular-15-client\\src\\app\\board-user\\board-user.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { UserService } from '../_services/user.service';\n\nimport Web3 from 'web3';\nimport { AbiItem } from 'web3-utils'\nconst alchemy = require (\"alchemy-sdk\");\n\n// deteethproviderfix dont care how do it  \n@Component({\n  selector: 'app-board-user',\n  templateUrl: './board-user.component.html',\n  styleUrls: ['./board-user.component.css']\n})\nexport class BoardUserComponent implements OnInit {\n  content?: string;\n  depositForm: any = {\n    ethValue: null,\n  };\n  private web3: Web3;\n  public walletConnected: boolean = false;\n  public walletId: string = '';\n  public walletBalance:string='';\n  private contractInst : any;\n\n  constructor(private userService: UserService,\n  ) { \n    const provider  = \"https://sepolia.infura.io/v3/acaa2699bfc84be092239f5676e3192a\"\n    this.web3 = new Web3(provider);\n    var web3Provider = new Web3.providers.HttpProvider(provider);\n    var web3 = new Web3(web3Provider);\n    this.contractInst = new this.web3.eth.Contract(this.userService.abiContract as AbiItem[],this.userService.contractAddress);\n  }\n\n  ngOnInit(): void {\n    this.connectToWallet();\n    this.userService.getUserBoard().subscribe({\n      next: data => {\n        this.content = data;\n      },\n      error: err => {\n        if (err.error) {\n          try {\n            const res = JSON.parse(err.error);\n            this.content = res.message;\n          } catch {\n            this.content = `Error with status: ${err.status} - ${err.statusText}`;\n          }\n        } else {\n          this.content = `Error with status: ${err.status}`;\n        }\n      }\n    });\n  }\n\n  connectToWallet  = () => {\n    this.userService.connectWallet();\n  }\n  checkWalletConnected = async () => {\n    const accounts = await this.userService.checkWalletConnected();\n    if(accounts.length > 0){\n      this.walletConnected = true;\n      this.walletId = accounts[0];\n      console.log(this.walletId);\n    }\n  }\n async getContractBalance(){\n    let contractBalance = this.contractInst.methods.getContractBalance()\n    .call();\n    return contractBalance;\n  }\n async getWalletId(){\n    let balance2 = await this.web3.eth.getBalance(this.walletId).then(res=>{this.walletBalance= res});\n  }\n\n  async onSubmit(): Promise<void> {\n    this.checkWalletConnected();\n    let balance;\n    balance = this.getContractBalance().then(res=>{console.log(this.web3.utils.fromWei(res, \"ether\"),\"eth\")});\n    console.log(this.depositForm);\n    console.log(this.walletId);\n    var accounts = await this.web3.eth.getAccounts().then(console.log);\n    let balance2 = await this.web3.eth.getBalance(this.walletId).then(res=>{this.walletBalance= res});\n    const transaction=this.web3.utils.toWei(String(this.depositForm.ethValue));\n    console.log(transaction,\"wei\");\n    //let txResult=await this.contractInst.methods.deposit().send({from: this.walletId,value:transaction});\n\n    var receiver = this.userService.contractAddress;  \n    var sender = this.walletId;\n    let rawTransaction = await this.web3.eth.signTransaction({\n      to:this.userService.contractAddress,\n      from:this.walletId,\n      value:transaction,\n    });\n\n    //let tx = await alchemy.core.sendTransaction(rawTransaction);\n\n   /* this.web3.eth.sendTransaction({to:receiver,\n                            from:sender, \n                           value:this.web3.utils.toWei(String(this.depositForm.ethValue), \"ether\")}\n                            ,function (err, res){});*/\n    /*let txResult2=await contractInst.methods.\n    withdrawToOther(transaction006, \"0xe1e481Ba1AD79E5d644440847eeabb139eA3Bf06\").\n    send({from: accounts[0]});\n    */\n    //console.log(txResult2);\n    const exampleMessage=\"Hello testing Sign\";\n    const msg = `0x${Buffer.from(exampleMessage, 'utf8').toString('hex')}`;\n  /*  const sign = await this.web3.eth.signTransaction({\n      from:this.walletId,\n    });*/\n\n  }\n\n}\n","<div class=\"container\">\n  <header class=\"jumbotron\">\n    <form class=\"form-group\"     \n    name=\"depositForm\"\n    #f=\"ngForm\" \n    (ngSubmit)=\"onSubmit()\">\n\n      <label for=\"ethValue\">Value:</label>\n      <input type=\"number\" class=\"ethValue\"           \n      [(ngModel)]=\"depositForm.ethValue\"\n      name=\"ethValue\"\n      >    \n      <button class=\"btn btn-primary btn-block\">Deposit here</button>\n    </form>\n    {{walletId}}\n    {{walletBalance+\" eth\"}} \n  </header>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}