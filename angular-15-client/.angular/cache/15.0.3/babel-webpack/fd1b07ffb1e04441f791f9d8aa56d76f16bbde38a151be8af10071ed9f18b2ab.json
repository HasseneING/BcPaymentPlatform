{"ast":null,"code":"import _asyncToGenerator from \"F:/DDesktop/MEAN_BC/mean-stack-authentication-authorization-master/angular-15-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Web3 from 'web3';\nimport { getWalletSOL } from '../contracts/contractABIs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_services/user.service\";\nimport * as i2 from \"../_services/storage.service\";\nimport * as i3 from \"@angular/forms\";\nconst alchemy = require(\"alchemy-sdk\");\nexport class BoardUserComponent {\n  constructor(userService, StorageService) {\n    var _this = this;\n    this.userService = userService;\n    this.StorageService = StorageService;\n    this.depositForm = {\n      ethValue: null\n    };\n    this.walletConnected = false;\n    this.walletId = '';\n    this.walletBalance = '';\n    this.forwarderAddress = '';\n    this.connectToWallet = () => {\n      this.userService.connectWallet();\n    };\n    this.checkWalletConnected = /*#__PURE__*/_asyncToGenerator(function* () {\n      const accounts = yield _this.userService.checkWalletConnected();\n      if (accounts.length > 0) {\n        _this.walletConnected = true;\n        _this.web3.eth.defaultAccount = accounts[0];\n        _this.walletId = accounts[0];\n        console.log(_this.walletId);\n      }\n    });\n    const provider = \"https://sepolia.infura.io/v3/acaa2699bfc84be092239f5676e3192a\"; //HAVE TO ADD .ENV FILE \n    var web3Provider = new Web3.providers.HttpProvider(provider);\n    this.web3 = new Web3(web3Provider);\n    this.contractInst = new this.web3.eth.Contract(this.userService.abiContract, this.userService.contractAddress);\n    this.walletContractInstance = new this.web3.eth.Contract(getWalletSOL().abi, getWalletSOL().address); //I NEED ENV FILE\n  }\n\n  ngOnInit() {\n    this.connectToWallet();\n    this.userService.getUserBoard().subscribe({\n      next: data => {\n        this.content = data;\n      },\n      error: err => {\n        if (err.error) {\n          try {\n            const res = JSON.parse(err.error);\n            this.content = res.message;\n          } catch {\n            this.content = `Error with status: ${err.status} - ${err.statusText}`;\n          }\n        } else {\n          this.content = `Error with status: ${err.status}`;\n        }\n      }\n    });\n  }\n  getContractBalance() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      let contractBalance = _this2.contractInst.methods.getContractBalance().call();\n      return contractBalance;\n    })();\n  }\n  getDepositedBalance() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      let depositedBalance = _this3.contractInst.methods.getContractBalance().call();\n    })();\n  }\n  getWalletId() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      let balance2 = yield _this4.web3.eth.getBalance(_this4.walletId).then(res => {\n        _this4.walletBalance = res;\n      });\n    })();\n  }\n  deployForwarder(walletAddress) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      // let forwarderCall= await this.walletContractInstance.methods.createForwarder().send({from:'0xaB544C4607e6498901c2702EB114d4D34b3650cE',});\n      //  console.log(this.forwarderAddress);\n      //we dont need to deploy wallet.sol it's already deployed, we create a forwarder from here some how xd\n      //A FORWARDER THAT'S GHONNA BE ATTACHED TO THIS USERID USING THE PRIVATE KEY OF WALLET.SOL\n      //https://ethereum.stackexchange.com/questions/67232/how-to-wait-until-transaction-is-confirmed-web3-js\n      //https://www.web3.university/tracks/create-a-smart-contract/integrate-your-smart-contract-with-a-frontend\n      //set up transaction parameters\n      const transactionParameters = {\n        from: _this5.walletId,\n        data: _this5.walletContractInstance.methods.createForwarder().encodeABI()\n      };\n      //sign the transaction\n      try {\n        const txHash = yield _this5.userService.ethereum.request({\n          method: \"eth_sendTransaction\",\n          gas: 21000,\n          params: [transactionParameters]\n        }).then(result => {\n          console.log(\"https://sepolia.etherscan.io/tx/\" + result);\n        });\n      } catch (error) {\n        console.log(\"error\" + error);\n      }\n    })();\n  }\n  updateForwarder() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      let truth = false;\n      _this6.deployForwarder(_this6.walletId);\n      console.log('ID' + _this6.forwarderAddress);\n      _this6.userService.update(_this6.forwarderAddress, _this6.StorageService.getUser().id).subscribe({\n        next: data => {\n          console.log(data);\n          truth = true;\n        },\n        error: err => {\n          console.log(err.error.message);\n        }\n      });\n      return truth;\n    })();\n  }\n  onSubmit() {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      _this7.checkWalletConnected();\n      let balance;\n      balance = _this7.getContractBalance().then(res => {\n        console.log(_this7.web3.utils.fromWei(res, \"ether\"), \"eth\");\n      });\n      console.log(_this7.depositForm);\n      console.log(_this7.walletId);\n      var accounts = yield _this7.web3.eth.getAccounts().then(console.log);\n      let balance2 = yield _this7.web3.eth.getBalance(_this7.walletId).then(res => {\n        _this7.walletBalance = res;\n      });\n      const transaction = _this7.web3.utils.toWei(String(_this7.depositForm.ethValue));\n      console.log(transaction, \"wei\");\n      var receiver = _this7.userService.contractAddress;\n      var sender = _this7.walletId;\n      //https://docs.metamask.io/wallet/reference/provider-api/#ethereum-request-args\n      if (_this7.StorageService.getUser().forwarderAddress === '0x0') {\n        console.log(\"is 0x0\");\n        _this7.userService.transactToAddress(_this7.walletId, \"0xa11c30ef3ba37bef5c86089bb8f7eb2eb90ab052\" /*this.StorageService.getUser().forwarderAddress*/, _this7.depositForm.ethValue);\n      } else {\n        console.log(\" isnt 0x0\");\n        _this7.updateForwarder().then(res => _this7.userService.transactToAddress(_this7.walletId, _this7.StorageService.getUser().forwarderAddress, _this7.depositForm.ethValue));\n      }\n    })();\n  }\n}\nBoardUserComponent.ɵfac = function BoardUserComponent_Factory(t) {\n  return new (t || BoardUserComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.StorageService));\n};\nBoardUserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: BoardUserComponent,\n  selectors: [[\"app-board-user\"]],\n  decls: 12,\n  vars: 3,\n  consts: [[1, \"container\"], [1, \"jumbotron\"], [\"name\", \"depositForm\", 1, \"form-group\", 3, \"ngSubmit\"], [\"f\", \"ngForm\"], [\"for\", \"ethValue\"], [\"type\", \"number\", \"name\", \"ethValue\", 1, \"ethValue\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn\", \"btn-primary\", \"btn-block\"], [1, \"btn\", \"btn-primary\", \"btn-block\", 3, \"click\"]],\n  template: function BoardUserComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"form\", 2, 3);\n      i0.ɵɵlistener(\"ngSubmit\", function BoardUserComponent_Template_form_ngSubmit_2_listener() {\n        return ctx.onSubmit();\n      });\n      i0.ɵɵelementStart(4, \"label\", 4);\n      i0.ɵɵtext(5, \"Value:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"input\", 5);\n      i0.ɵɵlistener(\"ngModelChange\", function BoardUserComponent_Template_input_ngModelChange_6_listener($event) {\n        return ctx.depositForm.ethValue = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"button\", 6);\n      i0.ɵɵtext(8, \"Deposit here\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(9, \"button\", 7);\n      i0.ɵɵlistener(\"click\", function BoardUserComponent_Template_button_click_9_listener() {\n        return ctx.deployForwarder(ctx.walletId);\n      });\n      i0.ɵɵtext(10, \"Deploy Forwarder\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(11);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngModel\", ctx.depositForm.ethValue);\n      i0.ɵɵadvance(5);\n      i0.ɵɵtextInterpolate2(\" \", ctx.walletId, \" \", ctx.walletBalance + \" eth\", \" \");\n    }\n  },\n  dependencies: [i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.NgModel, i3.NgForm],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":";AAGA,OAAOA,IAAI,MAAM,MAAM;AAEvB,SAA0BC,YAAY,QAAQ,2BAA2B;;;;;AAEzE,MAAMC,OAAO,GAAGC,OAAO,CAAC,aAAa,CAAC;AAOtC,OAAM,MAAOC,kBAAkB;EAa7BC,YAAoBC,WAAwB,EAAUC,cAA8B;IAAA;IAAhE,gBAAW,GAAXD,WAAW;IAAuB,mBAAc,GAAdC,cAAc;IAXpE,gBAAW,GAAQ;MACjBC,QAAQ,EAAE;KACX;IAEM,oBAAe,GAAY,KAAK;IAChC,aAAQ,GAAW,EAAE;IACrB,kBAAa,GAAW,EAAE;IAGzB,qBAAgB,GAAW,EAAE;IAkCrC,oBAAe,GAAG,MAAK;MACrB,IAAI,CAACF,WAAW,CAACG,aAAa,EAAE;IAClC,CAAC;IACD,yBAAoB,kCAAG,aAAW;MAChC,MAAMC,QAAQ,SAAS,KAAI,CAACJ,WAAW,CAACK,oBAAoB,EAAE;MAC9D,IAAID,QAAQ,CAACE,MAAM,GAAG,CAAC,EAAE;QACvB,KAAI,CAACC,eAAe,GAAG,IAAI;QAC3B,KAAI,CAACC,IAAI,CAACC,GAAG,CAACC,cAAc,GAAGN,QAAQ,CAAC,CAAC,CAAC;QAC1C,KAAI,CAACO,QAAQ,GAAGP,QAAQ,CAAC,CAAC,CAAC;QAC3BQ,OAAO,CAACC,GAAG,CAAC,KAAI,CAACF,QAAQ,CAAC;;IAE9B,CAAC;IAxCC,MAAMG,QAAQ,GAAG,+DAA+D,EAAC;IACjF,IAAIC,YAAY,GAAG,IAAIrB,IAAI,CAACsB,SAAS,CAACC,YAAY,CAACH,QAAQ,CAAC;IAC5D,IAAI,CAACN,IAAI,GAAG,IAAId,IAAI,CAACqB,YAAY,CAAC;IAClC,IAAI,CAACG,YAAY,GAAG,IAAI,IAAI,CAACV,IAAI,CAACC,GAAG,CAACU,QAAQ,CAAC,IAAI,CAACnB,WAAW,CAACoB,WAAwB,EAAE,IAAI,CAACpB,WAAW,CAACqB,eAAe,CAAC;IAC3H,IAAI,CAACC,sBAAsB,GAAG,IAAI,IAAI,CAACd,IAAI,CAACC,GAAG,CAACU,QAAQ,CAACxB,YAAY,EAAE,CAAC4B,GAAG,EAAE5B,YAAY,EAAE,CAAC6B,OAAO,CAAC,CAAC,CAAC;EACxG;;EAEAC,QAAQ;IAEN,IAAI,CAACC,eAAe,EAAE;IACtB,IAAI,CAAC1B,WAAW,CAAC2B,YAAY,EAAE,CAACC,SAAS,CAAC;MACxCC,IAAI,EAAEC,IAAI,IAAG;QACX,IAAI,CAACC,OAAO,GAAGD,IAAI;MACrB,CAAC;MACDE,KAAK,EAAEC,GAAG,IAAG;QACX,IAAIA,GAAG,CAACD,KAAK,EAAE;UACb,IAAI;YACF,MAAME,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAACD,KAAK,CAAC;YACjC,IAAI,CAACD,OAAO,GAAGG,GAAG,CAACG,OAAO;WAC3B,CAAC,MAAM;YACN,IAAI,CAACN,OAAO,GAAG,sBAAsBE,GAAG,CAACK,MAAM,MAAML,GAAG,CAACM,UAAU,EAAE;;SAExE,MAAM;UACL,IAAI,CAACR,OAAO,GAAG,sBAAsBE,GAAG,CAACK,MAAM,EAAE;;MAErD;KACD,CAAC;EACJ;EAcME,kBAAkB;IAAA;IAAA;MACtB,IAAIC,eAAe,GAAG,MAAI,CAACvB,YAAY,CAACwB,OAAO,CAACF,kBAAkB,EAAE,CACjEG,IAAI,EAAE;MACT,OAAOF,eAAe;IAAC;EACzB;EACMG,mBAAmB;IAAA;IAAA;MACvB,IAAIC,gBAAgB,GAAG,MAAI,CAAC3B,YAAY,CAACwB,OAAO,CAACF,kBAAkB,EAAE,CAClEG,IAAI,EAAE;IAAC;EACZ;EACMG,WAAW;IAAA;IAAA;MACf,IAAIC,QAAQ,SAAS,MAAI,CAACvC,IAAI,CAACC,GAAG,CAACuC,UAAU,CAAC,MAAI,CAACrC,QAAQ,CAAC,CAACsC,IAAI,CAACf,GAAG,IAAG;QAAG,MAAI,CAACgB,aAAa,GAAGhB,GAAG;MAAC,CAAC,CAAC;IAAC;EACzG;EACMiB,eAAe,CAACC,aAAqB;IAAA;IAAA;MACzC;MACA;MACA;MACA;MACJ;MACA;MACI;MACA,MAAMC,qBAAqB,GAAG;QAC5BC,IAAI,EAAE,MAAI,CAAC3C,QAAQ;QACnBmB,IAAI,EAAE,MAAI,CAACR,sBAAsB,CAACoB,OAAO,CAACa,eAAe,EAAE,CAACC,SAAS;OACtE;MAED;MACA,IAAI;QACF,MAAMC,MAAM,SAAS,MAAI,CAACzD,WAAW,CAAC0D,QAAQ,CAACC,OAAO,CAAC;UACrDC,MAAM,EAAE,qBAAqB;UAC7BC,GAAG,EAAC,KAAK;UACTC,MAAM,EAAE,CAACT,qBAAqB;SAC/B,CAAC,CAACJ,IAAI,CAAEc,MAAW,IAAI;UAAGnD,OAAO,CAACC,GAAG,CAAC,kCAAkC,GAACkD,MAAM,CAAC;QAAC,CAAC,CAAC;OACrF,CAAC,OAAO/B,KAAU,EAAE;QACnBpB,OAAO,CAACC,GAAG,CAAC,OAAO,GAACmB,KAAK,CAAC;;IAC3B;EAIH;EACMgC,eAAe;IAAA;IAAA;MACnB,IAAIC,KAAK,GAAG,KAAK;MACjB,MAAI,CAACd,eAAe,CAAC,MAAI,CAACxC,QAAQ,CAAC;MACnCC,OAAO,CAACC,GAAG,CAAC,IAAI,GAAG,MAAI,CAACqD,gBAAgB,CAAC;MACzC,MAAI,CAAClE,WAAW,CAACmE,MAAM,CAAC,MAAI,CAACD,gBAAgB,EAAE,MAAI,CAACjE,cAAc,CAACmE,OAAO,EAAE,CAACC,EAAE,CAAC,CAACzC,SAAS,CAAC;QACzFC,IAAI,EAAGC,IAAS,IAAI;UAClBlB,OAAO,CAACC,GAAG,CAACiB,IAAI,CAAC;UACjBmC,KAAK,GAAG,IAAI;QACd,CAAC;QACDjC,KAAK,EAAGC,GAAkC,IAAI;UAC5CrB,OAAO,CAACC,GAAG,CAACoB,GAAG,CAACD,KAAK,CAACK,OAAO,CAAC;QAChC;OACD,CAAC;MACF,OAAO4B,KAAK;IAAC;EACf;EACMK,QAAQ;IAAA;IAAA;MACZ,MAAI,CAACjE,oBAAoB,EAAE;MAC3B,IAAIkE,OAAO;MACXA,OAAO,GAAG,MAAI,CAAC/B,kBAAkB,EAAE,CAACS,IAAI,CAAEf,GAAQ,IAAI;QAAGtB,OAAO,CAACC,GAAG,CAAC,MAAI,CAACL,IAAI,CAACgE,KAAK,CAACC,OAAO,CAACvC,GAAG,EAAE,OAAO,CAAC,EAAE,KAAK,CAAC;MAAC,CAAC,CAAC;MACrHtB,OAAO,CAACC,GAAG,CAAC,MAAI,CAAC6D,WAAW,CAAC;MAC7B9D,OAAO,CAACC,GAAG,CAAC,MAAI,CAACF,QAAQ,CAAC;MAC1B,IAAIP,QAAQ,SAAS,MAAI,CAACI,IAAI,CAACC,GAAG,CAACkE,WAAW,EAAE,CAAC1B,IAAI,CAACrC,OAAO,CAACC,GAAG,CAAC;MAClE,IAAIkC,QAAQ,SAAS,MAAI,CAACvC,IAAI,CAACC,GAAG,CAACuC,UAAU,CAAC,MAAI,CAACrC,QAAQ,CAAC,CAACsC,IAAI,CAAEf,GAAQ,IAAI;QAAG,MAAI,CAACgB,aAAa,GAAGhB,GAAG;MAAC,CAAC,CAAC;MAC7G,MAAM0C,WAAW,GAAG,MAAI,CAACpE,IAAI,CAACgE,KAAK,CAACK,KAAK,CAACC,MAAM,CAAC,MAAI,CAACJ,WAAW,CAACxE,QAAQ,CAAC,CAAC;MAC5EU,OAAO,CAACC,GAAG,CAAC+D,WAAW,EAAE,KAAK,CAAC;MAC/B,IAAIG,QAAQ,GAAG,MAAI,CAAC/E,WAAW,CAACqB,eAAe;MAC/C,IAAI2D,MAAM,GAAG,MAAI,CAACrE,QAAQ;MAC1B;MACA,IAAI,MAAI,CAACV,cAAc,CAACmE,OAAO,EAAE,CAACF,gBAAgB,KAAK,KAAK,EAAE;QAC5DtD,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;QACrB,MAAI,CAACb,WAAW,CAACiF,iBAAiB,CAAC,MAAI,CAACtE,QAAQ,EAAE,4CAA4C,qDAAoD,MAAI,CAAC+D,WAAW,CAACxE,QAAQ,CAAC;OAC7K,MACI;QACHU,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC;QACxB,MAAI,CAACmD,eAAe,EAAE,CACnBf,IAAI,CAAEf,GAAQ,IAAK,MAAI,CAAClC,WAAW,CACjCiF,iBAAiB,CAAC,MAAI,CAACtE,QAAQ,EAAE,MAAI,CAACV,cAAc,CAACmE,OAAO,EAAE,CAACF,gBAAgB,EAAE,MAAI,CAACQ,WAAW,CAACxE,QAAQ,CAAC,CAAC;;IAClH;EACH;;AAtIWJ,kBAAkB;mBAAlBA,kBAAkB;AAAA;AAAlBA,kBAAkB;QAAlBA,kBAAkB;EAAAoF;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCd/BC,8BAAuB;MAKnBA;QAAA,OAAYC,cAAU;MAAA,EAAC;MAErBD,gCAAsB;MAAAA,sBAAM;MAAAA,iBAAQ;MACpCA,gCAGC;MAFDA;QAAA;MAAA,EAAkC;MADlCA,iBAGC;MACDA,iCAA0C;MAAAA,4BAAY;MAAAA,iBAAS;MAEjEA,iCAA8E;MAApCA;QAAA,OAASC,iCAAyB;MAAA,EAAC;MAACD,iCAAgB;MAAAA,iBAAS;MAEvGA,aAEF;MAAAA,iBAAS;;;MATLA,eAAkC;MAAlCA,kDAAkC;MAOpCA,eAEF;MAFEA,8EAEF","names":["Web3","getWalletSOL","alchemy","require","BoardUserComponent","constructor","userService","StorageService","ethValue","connectWallet","accounts","checkWalletConnected","length","walletConnected","web3","eth","defaultAccount","walletId","console","log","provider","web3Provider","providers","HttpProvider","contractInst","Contract","abiContract","contractAddress","walletContractInstance","abi","address","ngOnInit","connectToWallet","getUserBoard","subscribe","next","data","content","error","err","res","JSON","parse","message","status","statusText","getContractBalance","contractBalance","methods","call","getDepositedBalance","depositedBalance","getWalletId","balance2","getBalance","then","walletBalance","deployForwarder","walletAddress","transactionParameters","from","createForwarder","encodeABI","txHash","ethereum","request","method","gas","params","result","updateForwarder","truth","forwarderAddress","update","getUser","id","onSubmit","balance","utils","fromWei","depositForm","getAccounts","transaction","toWei","String","receiver","sender","transactToAddress","selectors","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["F:\\DDesktop\\MEAN_BC\\mean-stack-authentication-authorization-master\\angular-15-client\\src\\app\\board-user\\board-user.component.ts","F:\\DDesktop\\MEAN_BC\\mean-stack-authentication-authorization-master\\angular-15-client\\src\\app\\board-user\\board-user.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { UserService } from '../_services/user.service';\nimport { StorageService } from '../_services/storage.service';\nimport Web3 from 'web3';\nimport { AbiItem } from 'web3-utils'\nimport { getForwarderSOL, getWalletSOL } from '../contracts/contractABIs';\nimport { from } from 'rxjs';\nconst alchemy = require(\"alchemy-sdk\");\n\n@Component({\n  selector: 'app-board-user',\n  templateUrl: './board-user.component.html',\n  styleUrls: ['./board-user.component.css']\n})\nexport class BoardUserComponent implements OnInit {\n  content?: string;\n  depositForm: any = {\n    ethValue: null,\n  };\n  private web3: Web3;\n  public walletConnected: boolean = false;\n  public walletId: string = '';\n  public walletBalance: string = '';\n  private contractInst: any;\n  private walletContractInstance: any;\n  private forwarderAddress: string = '';\n\n  constructor(private userService: UserService, private StorageService: StorageService,\n  ) {\n\n    const provider = \"https://sepolia.infura.io/v3/acaa2699bfc84be092239f5676e3192a\" //HAVE TO ADD .ENV FILE \n    var web3Provider = new Web3.providers.HttpProvider(provider);\n    this.web3 = new Web3(web3Provider);\n    this.contractInst = new this.web3.eth.Contract(this.userService.abiContract as AbiItem[], this.userService.contractAddress);\n    this.walletContractInstance = new this.web3.eth.Contract(getWalletSOL().abi, getWalletSOL().address); //I NEED ENV FILE\n  }\n\n  ngOnInit(): void {\n\n    this.connectToWallet();\n    this.userService.getUserBoard().subscribe({\n      next: data => {\n        this.content = data;\n      },\n      error: err => {\n        if (err.error) {\n          try {\n            const res = JSON.parse(err.error);\n            this.content = res.message;\n          } catch {\n            this.content = `Error with status: ${err.status} - ${err.statusText}`;\n          }\n        } else {\n          this.content = `Error with status: ${err.status}`;\n        }\n      }\n    });\n  }\n\n  connectToWallet = () => {\n    this.userService.connectWallet();\n  }\n  checkWalletConnected = async () => {\n    const accounts = await this.userService.checkWalletConnected();\n    if (accounts.length > 0) {\n      this.walletConnected = true;\n      this.web3.eth.defaultAccount = accounts[0];\n      this.walletId = accounts[0];\n      console.log(this.walletId);\n    }\n  }\n  async getContractBalance() {\n    let contractBalance = this.contractInst.methods.getContractBalance()\n      .call();\n    return contractBalance;\n  }\n  async getDepositedBalance() {\n    let depositedBalance = this.contractInst.methods.getContractBalance()\n      .call();\n  }\n  async getWalletId() {//balance?\n    let balance2 = await this.web3.eth.getBalance(this.walletId).then(res => { this.walletBalance = res });\n  }\n  async deployForwarder(walletAddress: String) {\n    // let forwarderCall= await this.walletContractInstance.methods.createForwarder().send({from:'0xaB544C4607e6498901c2702EB114d4D34b3650cE',});\n    //  console.log(this.forwarderAddress);\n    //we dont need to deploy wallet.sol it's already deployed, we create a forwarder from here some how xd\n    //A FORWARDER THAT'S GHONNA BE ATTACHED TO THIS USERID USING THE PRIVATE KEY OF WALLET.SOL\n//https://ethereum.stackexchange.com/questions/67232/how-to-wait-until-transaction-is-confirmed-web3-js\n//https://www.web3.university/tracks/create-a-smart-contract/integrate-your-smart-contract-with-a-frontend\n    //set up transaction parameters\n    const transactionParameters = {\n      from: this.walletId, // must match user's active address.\n      data: this.walletContractInstance.methods.createForwarder().encodeABI(),\n    };\n\n    //sign the transaction\n    try {\n      const txHash = await this.userService.ethereum.request({\n        method: \"eth_sendTransaction\",\n        gas:21000,\n        params: [transactionParameters],\n      }).then((result: any) => { console.log(\"https://sepolia.etherscan.io/tx/\"+result) });\n    } catch (error: any) {\n      console.log(\"error\"+error);\n    }\n\n\n\n  }\n  async updateForwarder() {\n    let truth = false;\n    this.deployForwarder(this.walletId);\n    console.log('ID' + this.forwarderAddress);\n    this.userService.update(this.forwarderAddress, this.StorageService.getUser().id).subscribe({\n      next: (data: any) => {\n        console.log(data);\n        truth = true;\n      },\n      error: (err: { error: { message: any; }; }) => {\n        console.log(err.error.message);\n      }\n    });\n    return truth;\n  }\n  async onSubmit(): Promise<void> {\n    this.checkWalletConnected();\n    let balance;\n    balance = this.getContractBalance().then((res: any) => { console.log(this.web3.utils.fromWei(res, \"ether\"), \"eth\") });\n    console.log(this.depositForm);\n    console.log(this.walletId);\n    var accounts = await this.web3.eth.getAccounts().then(console.log);\n    let balance2 = await this.web3.eth.getBalance(this.walletId).then((res: any) => { this.walletBalance = res });\n    const transaction = this.web3.utils.toWei(String(this.depositForm.ethValue));\n    console.log(transaction, \"wei\");\n    var receiver = this.userService.contractAddress;\n    var sender = this.walletId;\n    //https://docs.metamask.io/wallet/reference/provider-api/#ethereum-request-args\n    if (this.StorageService.getUser().forwarderAddress === '0x0') {\n      console.log(\"is 0x0\");\n      this.userService.transactToAddress(this.walletId, \"0xa11c30ef3ba37bef5c86089bb8f7eb2eb90ab052\"/*this.StorageService.getUser().forwarderAddress*/, this.depositForm.ethValue)\n    }\n    else {\n      console.log(\" isnt 0x0\");\n      this.updateForwarder()\n        .then((res: any) => this.userService\n          .transactToAddress(this.walletId, this.StorageService.getUser().forwarderAddress, this.depositForm.ethValue))\n    }\n  }\n}\n","<div class=\"container\">\n  <header class=\"jumbotron\">\n    <form class=\"form-group\"     \n    name=\"depositForm\"\n    #f=\"ngForm\" \n    (ngSubmit)=\"onSubmit()\">\n\n      <label for=\"ethValue\">Value:</label>\n      <input type=\"number\" class=\"ethValue\"           \n      [(ngModel)]=\"depositForm.ethValue\"\n      name=\"ethValue\"\n      >    \n      <button class=\"btn btn-primary btn-block\">Deposit here</button>\n    </form>\n    <button class=\"btn btn-primary btn-block\" (click)=\"deployForwarder(walletId)\">Deploy Forwarder</button>\n\n    {{walletId}}\n    {{walletBalance+\" eth\"}} \n  </header>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}